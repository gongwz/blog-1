<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="在本文中，我们将使用Django开发一个人力资源（HR）应用程序，并在员工和管理之间建立递归关系。 设置Django项目结构为了不影响系统环境，你也许会创建一个虚拟环境，当然我已经建立好了虚拟环境，我们开始创建Django项目吧 (test) $ pip install django 安装Django后，可以利用django-admin生成项目模板，我们称之为webapp。 (test) $ dj">
<meta name="keywords" content="安生,Python">
<meta property="og:type" content="article">
<meta property="og:title" content="Django中的递归模型关系">
<meta property="og:url" content="https://blog.ansheng.me/article/recursive-model-relationships-in-django/index.html">
<meta property="og:site_name" content="Welcome to ansheng’s blog!">
<meta property="og:description" content="在本文中，我们将使用Django开发一个人力资源（HR）应用程序，并在员工和管理之间建立递归关系。 设置Django项目结构为了不影响系统环境，你也许会创建一个虚拟环境，当然我已经建立好了虚拟环境，我们开始创建Django项目吧 (test) $ pip install django 安装Django后，可以利用django-admin生成项目模板，我们称之为webapp。 (test) $ dj">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://blog.ansheng.me/images/2017/10/1507689271591157.png">
<meta property="og:updated_time" content="2018-07-27T03:26:40.091Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django中的递归模型关系">
<meta name="twitter:description" content="在本文中，我们将使用Django开发一个人力资源（HR）应用程序，并在员工和管理之间建立递归关系。 设置Django项目结构为了不影响系统环境，你也许会创建一个虚拟环境，当然我已经建立好了虚拟环境，我们开始创建Django项目吧 (test) $ pip install django 安装Django后，可以利用django-admin生成项目模板，我们称之为webapp。 (test) $ dj">
<meta name="twitter:image" content="https://blog.ansheng.me/images/2017/10/1507689271591157.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
          
        
    
    <!-- title -->
    <title>Django中的递归模型关系</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg active"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg active"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu" style="visibility: visible;">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/article/django-using-oracle-database/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/article/the-god-of-the-beginning-of-the-editor/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#设置Django项目结构"><span class="toc-number">1.</span> <span class="toc-text">设置Django项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置路由"><span class="toc-number">2.</span> <span class="toc-text">配置路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图"><span class="toc-number">3.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设计模型类"><span class="toc-number">4.</span> <span class="toc-text">设计模型类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成数据表"><span class="toc-number">5.</span> <span class="toc-text">生成数据表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用Django-Shell创建数据"><span class="toc-number">6.</span> <span class="toc-text">用Django Shell创建数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建显示模板"><span class="toc-number">7.</span> <span class="toc-text">创建显示模板</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Django中的递归模型关系
    </h1>



    <div class="meta">
      <span class="postdate">创建日期：</span>
    <div class="postdate">
        <time datetime="2017-10-10T16:00:00.000Z" itemprop="datePublished">2017-10-11</time>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>在本文中，我们将使用<code>Django</code>开发一个人力资源（HR）应用程序，并在员工和管理之间建立递归关系。</p>
<h2 id="设置Django项目结构"><a href="#设置Django项目结构" class="headerlink" title="设置Django项目结构"></a>设置Django项目结构</h2><p>为了不影响系统环境，你也许会创建一个虚拟环境，当然我已经建立好了虚拟环境，我们开始创建<code>Django</code>项目吧</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ pip install django</span><br></pre></td></tr></table></figure>
<p>安装Django后，可以利用<code>django-admin</code>生成项目模板，我们称之为<code>webapp</code>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ django-admin startproject webapp</span><br></pre></td></tr></table></figure>
<p>现在<code>cd</code>进入新的<code>webapp</code>目录，我们通过<code>manage.py</code>脚本提供的<code>django工具</code>。我们使用它来创建项目的应用程序，我们将其命名为<code>hrmgmt</code>。这将创建另一个名为<code>hrmgmt</code>的目录，这是该应用程序的代码所在的位置。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ <span class="built_in">cd</span> webapp/</span><br><span class="line">(<span class="built_in">test</span>) $ python manage.py startapp hrmgmt</span><br></pre></td></tr></table></figure>
<p>最后我们还需要将刚创建的<code>hrmgmt</code>APP注册到django项目的APP列表中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># webapp/settings.py</span></span><br><span class="line"><span class="comment"># Application definition</span></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ......</span><br><span class="line">    <span class="string">'hrmgmt.apps.HrmgmtConfig'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h2><p>在<code>webapp/urls.py</code>中使用以下代码将所有以<code>/hr</code>为前缀的路由重定向到<code>hrmgmt</code>应用程序中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># webapp/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include  </span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [  </span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r'^hr/'</span>, include(<span class="string">'hrmgmt.urls'</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在<code>hrmgmt</code>应用程序中，创建一个名为<code>urls.py</code>的新文件，并放置以下代码。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hrmgmt/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># /hr/</span></span><br><span class="line">    url(<span class="string">r'^$'</span>, views.index, name=<span class="string">'index'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这将指定一个视图，它将返回所有员工的列表。上面的代码使用正则表达式来表示当从我们的服务器请求<code>/hr/</code>的路由时，一个名为<code>index</code>的视图函数应该处理该请求并返回一个响应。</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>现在我们来实现前面提到的<code>index</code>视图函数来处理对<code>/hr/</code>的路由的请求，并返回一个文本响应。</p>
<p>在<code>hrmgmt/views.py</code>中包含以下代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hrmgmt/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span>  </span><br><span class="line">    response = <span class="string">"My List of Employees Goes Here"</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(response)</span><br></pre></td></tr></table></figure>
<p>在webapp目录下，启动Django并测试我们已经正确配置了路由和查看功能：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ python manage.py runserver</span><br></pre></td></tr></table></figure>
<p>现在打开浏览器，输入<code>http://127.0.0.1:8000/hr/</code>,就可以看到<code>My List of Employees Goes Here</code>。</p>
<h2 id="设计模型类"><a href="#设计模型类" class="headerlink" title="设计模型类"></a>设计模型类</h2><p>在本节中，我们定义我们的模型类，它将转换成数据库表，所有这些都通过编写Python代码来完成。</p>
<p>在<code>hrmgmt/models.py</code>中放置以下代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hrmgmt/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(models.Model)</span>:</span>  </span><br><span class="line">    STANDARD = <span class="string">'STD'</span></span><br><span class="line">    MANAGER = <span class="string">'MGR'</span></span><br><span class="line">    SR_MANAGER = <span class="string">'SRMGR'</span></span><br><span class="line">    PRESIDENT = <span class="string">'PRES'</span></span><br><span class="line"></span><br><span class="line">    EMPLOYEE_TYPES = (</span><br><span class="line">        (STANDARD, <span class="string">'base employee'</span>),</span><br><span class="line">        (MANAGER, <span class="string">'manager'</span>),</span><br><span class="line">        (SR_MANAGER, <span class="string">'senior manager'</span>),</span><br><span class="line">        (PRESIDENT, <span class="string">'president'</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    role = models.CharField(max_length=<span class="number">25</span>, choices=EMPLOYEE_TYPES)</span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    manager = models.ForeignKey(<span class="string">'self'</span>, null=<span class="keyword">True</span>, related_name=<span class="string">'employee'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;Employee: &#123;&#125; &#123;&#125;&gt;"</span>.format(self.first_name, self.last_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__str__()</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们创建了一个django的model<code>Employee</code>，该类具有Django的ORM访问数据库的功能。</p>
<p>接下来是四个类字段的定义，它们是常量（STANDARD，MANAGER，SR_MANAGER，PRESIDENT）以及它们用于进一步定义元组类字段常量的定义。这些类似于枚举，它们指定了员工可以承担的不同角色。</p>
<p>接下来<code>first_name</code>，<code>last_name</code>字段被定义为最大长度为100个字符的字符。</p>
<p>最后一个字段定义员工与管理之间递归关系的外键，这意味着Django对继承的模型所做的隐式自动递增整数<code>id</code>列<code>django.db.models.Model</code>将作为同一个类（或表）的外键值提供。</p>
<h2 id="生成数据表"><a href="#生成数据表" class="headerlink" title="生成数据表"></a>生成数据表</h2><p>运行以下命令创建所有Django应用程序使用的表。默认情况下，数据库使用的是<code>sqlite</code>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ python manage.py makemigrations</span><br><span class="line">(<span class="built_in">test</span>) $ python manage.py migrate</span><br></pre></td></tr></table></figure>
<p>您可以通过运行以下命令来查看创建表的实际SQL：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ python manage.py sqlmigrate hrmgmt 0001</span><br><span class="line">BEGIN;</span><br><span class="line">--</span><br><span class="line">-- Create model Employee</span><br><span class="line">--</span><br><span class="line">CREATE TABLE <span class="string">"hrmgmt_employee"</span> (<span class="string">"id"</span> <span class="built_in">integer</span> NOT NULL PRIMARY KEY AUTOINCREMENT, <span class="string">"role"</span> varchar(25) NOT NULL, <span class="string">"first_name"</span> varchar(100) NOT NULL, <span class="string">"last_name"</span> varchar(100) NOT NULL, <span class="string">"manager_id"</span> <span class="built_in">integer</span> NULL REFERENCES <span class="string">"hrmgmt_employee"</span> (<span class="string">"id"</span>));</span><br><span class="line">CREATE INDEX <span class="string">"hrmgmt_employee_manager_id_43028de6"</span> ON <span class="string">"hrmgmt_employee"</span> (<span class="string">"manager_id"</span>);</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>
<h2 id="用Django-Shell创建数据"><a href="#用Django-Shell创建数据" class="headerlink" title="用Django Shell创建数据"></a>用Django Shell创建数据</h2><p>输入以下命令，进入带<code>Django</code>环境的Python解释器：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">test</span>) $ python manage.py shell</span><br></pre></td></tr></table></figure>
<p>下面的代码创建了四名员工。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> hrmgmt.models <span class="keyword">import</span> Employee</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>janeD = Employee.objects.create(first_name=<span class="string">'Jane'</span>, last_name=<span class="string">'Doe'</span>, role=Employee.PRESIDENT)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>johnD = Employee.objects.create(first_name=<span class="string">'John'</span>, last_name=<span class="string">'Doe'</span>, role=Employee.MANAGER, manager=janeD)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joeS = Employee.objects.create(first_name=<span class="string">'Joe'</span>, last_name=<span class="string">'Scho'</span>, role=Employee.STANDARD, manager=johnD)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>johnB = Employee.objects.create(first_name=<span class="string">'John'</span>, last_name=<span class="string">'Brown'</span>, role=Employee.STANDARD, manager=johnD)</span><br></pre></td></tr></table></figure>
<h2 id="创建显示模板"><a href="#创建显示模板" class="headerlink" title="创建显示模板"></a>创建显示模板</h2><p>在<code>hrmgmt</code>目录中创建另一个名为<code>templates</code>的目录。然后在<code>templates</code>目录下再创建一个名为<code>hrmgmt</code>的目录。最后在<code>hrmgmt/templates/hrmgmt</code>目录下创建一个名为<code>index.html</code>的HTML文件。在这个文件中，我们将编写代码来构建我们的员工列表。</p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hrmgmt/templates/hrmgmt/index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Employee Listing<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdn.bootcss.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"</span> <span class="attr">integrity</span>=<span class="string">"sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Employee Listing<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dov</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span> <span class="attr">class</span>=<span class="string">"thead-inverse"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Employee ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Last Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Role<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Manager<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">class</span>=<span class="string">'table-striped'</span>&gt;</span></span><br><span class="line">                &#123;% for employee in employees %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; employee.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; employee.first_name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; employee.last_name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; employee.get_role_display &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;% if employee.manager %&#125;&#123;&#123; employee.manager.first_name &#125;&#125; &#123;&#123; employee.manager.last_name &#125;&#125;&#123;% endif %&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dov</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/popper.js/1.11.0/umd/popper.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们需要在<code>view</code>中获取所有的员工数据，然后传递给html模板中。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hrmgmt/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Employee</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    employees = Employee.objects.order_by(<span class="string">'id'</span>).all()</span><br><span class="line">    context = &#123;<span class="string">'employees'</span>: employees&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'hrmgmt/index.html'</span>, context)</span><br></pre></td></tr></table></figure>
<p>再次启动<code>Django</code>服务，打开浏览器输入<code>http://127.0.0.1:8000/hr/</code>,你将会看到如下截图：</p>
<p><img src="/images/2017/10/1507689271591157.png" alt="1507689271591157"></p>

  </div>
</article>
<div style="text-align:center">
  <hr>
  <img src="/images/wechat.jpg" alt="wechat" style="width:450px;">
</div>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#设置Django项目结构"><span class="toc-number">1.</span> <span class="toc-text">设置Django项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置路由"><span class="toc-number">2.</span> <span class="toc-text">配置路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图"><span class="toc-number">3.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设计模型类"><span class="toc-number">4.</span> <span class="toc-text">设计模型类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成数据表"><span class="toc-number">5.</span> <span class="toc-text">生成数据表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用Django-Shell创建数据"><span class="toc-number">6.</span> <span class="toc-text">用Django Shell创建数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建显示模板"><span class="toc-number">7.</span> <span class="toc-text">创建显示模板</span></a></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 ansheng
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-89592236-1', 'auto');
        ga('send', 'pageview');
    </script>


<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'blog-ansheng-me';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


