<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="什么是NFS?NFS就是Network FileSystem的缩写，最早之前是由Sun所发展出来的。他最大的功能就是可以透过网络，让不同的机器、不同的操作系统、可以彼此分享个别的档案(share file)，所以，也可以简单的将他看做是一个file server呢！这个NFS Server可以让你的PC来将网络远程的NFS主机分享的目录，挂载到本地端的机器当中，所以，在本地端的机器看起来，那个远程">
<meta name="keywords" content="安生,Python">
<meta property="og:type" content="article">
<meta property="og:title" content="初步认识NFS网络文件系统">
<meta property="og:url" content="https://blog.ansheng.me/article/nfs-network-file-system/index.html">
<meta property="og:site_name" content="Welcome to ansheng’s blog!">
<meta property="og:description" content="什么是NFS?NFS就是Network FileSystem的缩写，最早之前是由Sun所发展出来的。他最大的功能就是可以透过网络，让不同的机器、不同的操作系统、可以彼此分享个别的档案(share file)，所以，也可以简单的将他看做是一个file server呢！这个NFS Server可以让你的PC来将网络远程的NFS主机分享的目录，挂载到本地端的机器当中，所以，在本地端的机器看起来，那个远程">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://blog.ansheng.me/images/2016/12/1483011827504.png">
<meta property="og:updated_time" content="2018-07-27T03:26:40.068Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="初步认识NFS网络文件系统">
<meta name="twitter:description" content="什么是NFS?NFS就是Network FileSystem的缩写，最早之前是由Sun所发展出来的。他最大的功能就是可以透过网络，让不同的机器、不同的操作系统、可以彼此分享个别的档案(share file)，所以，也可以简单的将他看做是一个file server呢！这个NFS Server可以让你的PC来将网络远程的NFS主机分享的目录，挂载到本地端的机器当中，所以，在本地端的机器看起来，那个远程">
<meta name="twitter:image" content="https://blog.ansheng.me/images/2016/12/1483011827504.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
          
        
    
    <!-- title -->
    <title>初步认识NFS网络文件系统</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg active"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg active"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu" style="visibility: visible;">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/article/automatically-register-tornado-routes-with-decorators/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/article/linux-curl-header-status-code/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是NFS"><span class="toc-number">1.</span> <span class="toc-text">什么是NFS?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RPC"><span class="toc-number">2.</span> <span class="toc-text">RPC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS在企业中的应用场景"><span class="toc-number">3.</span> <span class="toc-text">NFS在企业中的应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS的安装"><span class="toc-number">4.</span> <span class="toc-text">NFS的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nfs-utils"><span class="toc-number">4.1.</span> <span class="toc-text">nfs-utils</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rpcbind"><span class="toc-number">4.2.</span> <span class="toc-text">rpcbind</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询有没有安装软件包"><span class="toc-number">4.3.</span> <span class="toc-text">查询有没有安装软件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装软件包"><span class="toc-number">4.4.</span> <span class="toc-text">安装软件包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS配置文件路径"><span class="toc-number">5.</span> <span class="toc-text">NFS配置文件路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#showmount命令"><span class="toc-number">6.</span> <span class="toc-text">showmount命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exportfs命令"><span class="toc-number">7.</span> <span class="toc-text">exportfs命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS-server端设置"><span class="toc-number">8.</span> <span class="toc-text">NFS server端设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#etc-exports"><span class="toc-number">8.1.</span> <span class="toc-text">/etc/exports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS配置参数"><span class="toc-number">8.2.</span> <span class="toc-text">NFS配置参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#客户端IP地址"><span class="toc-number">9.</span> <span class="toc-text">客户端IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置NFS生产重要技巧"><span class="toc-number">9.1.</span> <span class="toc-text">配置NFS生产重要技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战配置NFS服务"><span class="toc-number">10.</span> <span class="toc-text">实战配置NFS服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置NFS服务端"><span class="toc-number">10.1.</span> <span class="toc-text">配置NFS服务端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS客户端挂载"><span class="toc-number">11.</span> <span class="toc-text">NFS客户端挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开机自动挂载NFS"><span class="toc-number">12.</span> <span class="toc-text">开机自动挂载NFS</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        初步认识NFS网络文件系统
    </h1>



    <div class="meta">
      <span class="postdate">创建日期：</span>
    <div class="postdate">
        <time datetime="2017-05-23T16:00:00.000Z" itemprop="datePublished">2017-05-24</time>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="什么是NFS"><a href="#什么是NFS" class="headerlink" title="什么是NFS?"></a>什么是NFS?</h2><p>NFS就是<code>Network FileSystem</code>的缩写，最早之前是由Sun所发展出来的。他最大的功能就是可以透过网络，让不同的机器、不同的操作系统、可以彼此分享个别的档案(share file)，所以，也可以简单的将他看做是一个file server呢！这个NFS Server可以让你的PC来将网络远程的NFS主机分享的目录，挂载到本地端的机器当中，所以，在本地端的机器看起来，那个远程主机的目录就好象是自己的partition一般！</p>
<p>虽然NFS有属于自己的协议与使用的端口号，但是在资料传送或者其它相关讯息传递的时候，NFS使用的则是一个称为远程过程调用(Remote Procedure Call, RPC)的协议来协助NFS本身的运作！</p>
<p>NFS的主要功能是通过网络让不同的主机系统之间可以彼此共享文件或目录，NFS网络文件系统的使用很像Windows系统的网络共享，安全功能，网络驱动器映射，这也和Linux里面的samba服务类似。</p>
<hr>
<h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><p>因为NFS支持的功能很多，而不同的功能都会使用不同的程序来启动，没启动一个功能就会启用一些端口来传输数据，应此，NFS的功能所对应的端口是无法固定的，二十随机取用一些违背使用的端口来作为传输工具，其中Centos5X随机端口小于1024的，而Centos6X都是比较大的。</p>
<p>因为端口不固定，这样一来就会造成NFS客户端与NFS服务端的通讯障碍，运维NFS客户端必须要知道NFS服务器端的数据传输端口才能进行通讯交互数据。</p>
<p>要解决上面的通讯问题困扰，就需要远程调用RPC服务来帮忙了，NFS的RPC服务最主要的功能就是记录每个NFS功能所对应的嘟啊口号，并且在NFS客户端请求时将该端口和功能对应的信息传递给请求数据的NFS客户端，从而可以确保客户端可以连接到正确的NFS端口上去，达到实现数据传输交互数据目的，这个RPC服务很类似NFS服务端和NFS客户端之间的一个中介。</p>
<p>NFS的RPC服务在CentOS5.x下名称为portmap，在CentOS6.x下名称为rocbind</p>
<p><img src="/images/2016/12/1483011827504.png" alt="nfs-rpc"></p>
<h2 id="NFS在企业中的应用场景"><a href="#NFS在企业中的应用场景" class="headerlink" title="NFS在企业中的应用场景"></a>NFS在企业中的应用场景</h2><p>在企业集群架构中，NFS网络文件系统一般被用来存储共享视频、图片、附件等静态资源文件（一般把网站用户上传的文件放到共享里，例如：BBS产品的图片、附件、头像，注意网站BBS程序不要放在共享里），NFS是当前互联网系统架构中最常用的数据存储服务器之一，特别是中小型网络公司应用频率很高。大公司或门户除了使用NFS之外，还可能会使用MFS、GFS、FASTFS、TFS等分布式文件系统。</p>
<h2 id="NFS的安装"><a href="#NFS的安装" class="headerlink" title="NFS的安装"></a>NFS的安装</h2><h3 id="nfs-utils"><a href="#nfs-utils" class="headerlink" title="nfs-utils"></a>nfs-utils</h3><p>nfs-utils就是提供rpc.nfsd及rpc.mountd这两个NFS daemons与其它相关documents与说明文件、执行档等的套件！这个就是 NFS 的主要套件</p>
<h3 id="rpcbind"><a href="#rpcbind" class="headerlink" title="rpcbind"></a>rpcbind</h3><p>rpcbind就如同刚刚提的到，我们的NFS其实可以被视为一个RPC server program，而要激活任何一个RPC server program之前，我们都需要做好port的对应(mapping)的工作才行，这个工作其实就是『rpcbind』这个服务所负责的！也就是说，在激活任何一个RPC server之前，我们都需要激活rpcbind才行呢！那么这个rpcbind到底在干嘛呢？就如同这个服务的名称，哈哈！就是作port的mapping啊！举个例子来说：当Client端尝试来使用RPC server所提供的服务时，由于Client需要取得一个可以连接的port才能够使用RPC server所提供的服务，因此，Client首先就会去跟rpcbind讲『喂！可不可以通知一下，给我个port number，好让我可以跟RPC联络吧！』这个时候rpcbind就自动的将自己管理的port mapping告知Client，好让他可以连接上来server呢！『激活NFS之前，请先激活rpcbind』</p>
<h3 id="查询有没有安装软件包"><a href="#查询有没有安装软件包" class="headerlink" title="查询有没有安装软件包"></a>查询有没有安装软件包</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># rpm -qa | grep -E "nfs|rpcbind"</span></span><br></pre></td></tr></table></figure>
<h3 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h3><p>安装包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># yum -y install nfs-utils rpcbind</span></span><br></pre></td></tr></table></figure>
<p>或者安装组</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># yum -y groupinstall "NFS file server"</span></span><br></pre></td></tr></table></figure>
<p>查询</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># rpm -qa | grep -E "nfs|rpcbind"</span></span><br><span class="line">nfs-utils-1.2.3-64.el6.x86_64</span><br><span class="line">nfs-utils-lib-1.1.5-11.el6.x86_64</span><br><span class="line">nfs4-acl-tools-0.3.3-7.el6.x86_64</span><br><span class="line">rpcbind-0.2.0-11.el6_7.x86_64</span><br></pre></td></tr></table></figure>
<h2 id="NFS配置文件路径"><a href="#NFS配置文件路径" class="headerlink" title="NFS配置文件路径"></a>NFS配置文件路径</h2><table>
<thead>
<tr>
<th style="text-align:left">NFS常用路径</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">/etc/exports</td>
<td style="text-align:left">NFS服务主配置文件，配置NFS具体共享服务的地点，默认内容为空</td>
</tr>
<tr>
<td style="text-align:left">/usr/sbin/exportfs</td>
<td style="text-align:left">NFS的管理命令，见第五节介绍</td>
</tr>
<tr>
<td style="text-align:left">/usr/sbin/showmount</td>
<td style="text-align:left">常用来在客户端，查看NFS配置及共享目录的情况</td>
</tr>
<tr>
<td style="text-align:left">/var/lib/nfs/etab</td>
<td style="text-align:left">NFS配置文件的完整参数设定的文件（有很多没有配置单默认就有的参数）</td>
</tr>
</tbody>
</table>
<h2 id="showmount命令"><a href="#showmount命令" class="headerlink" title="showmount命令"></a>showmount命令</h2><p><strong>语法：</strong><br> showmount [-ae] hostname</p>
<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-a</td>
<td style="text-align:left">显示目前主机与client所连上来的使用目录的状态</td>
</tr>
<tr>
<td style="text-align:left">-e</td>
<td style="text-align:left">显示hostname的/etc/exports里面共享的目录</td>
</tr>
</tbody>
</table>
<p><strong>实例：</strong></p>
<p>查看NFS服务端共享的目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># showmount -e localhost</span></span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br><span class="line">/mnt 172.16.10.0/24</span><br></pre></td></tr></table></figure>
<h2 id="exportfs命令"><a href="#exportfs命令" class="headerlink" title="exportfs命令"></a>exportfs命令</h2><p>如果我们修改了/etc/exports后，并不需要重启nfs服务，只要用exportfs重新扫描一次/etc/exports，并且重新加载即可。</p>
<p><strong>语法:</strong><br> exportfs [-aruv]</p>
<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-a</td>
<td style="text-align:left">全部挂载(或卸载) /etc/exports档案内的设定</td>
</tr>
<tr>
<td style="text-align:left">-r</td>
<td style="text-align:left">重新挂载/etc/exports里面的设定</td>
</tr>
<tr>
<td style="text-align:left">-u</td>
<td style="text-align:left">卸载某一目录</td>
</tr>
<tr>
<td style="text-align:left">-v</td>
<td style="text-align:left">在export的时候，将分享的目录显示到荧屏上</td>
</tr>
</tbody>
</table>
<p><strong>实例：</strong></p>
<p>exportfs不重启生效法</p>
<p>启动NFS服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/rpcbind start</span></span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/nfs start</span></span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure>
<p>查看是否有共享的目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># showmount -e localhost</span></span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br></pre></td></tr></table></figure>
<p>添加共享目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># echo '/mnt 172.16.10.0/24(rw,sync)' &gt;&gt; /etc/exports</span></span><br><span class="line">[root@ansheng ~]<span class="comment"># cat /etc/exports </span></span><br><span class="line">/mnt 172.16.10.0/24(rw,sync)</span><br></pre></td></tr></table></figure>
<p>不重启NFS服务器查看是否有共享的目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># showmount -e localhost</span></span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br></pre></td></tr></table></figure>
<p>利用exportfs生效NFS配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># exportfs -rv</span></span><br><span class="line">exporting 172.16.10.0/24:/mnt</span><br></pre></td></tr></table></figure>
<p>查看共享目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># showmount -e localhost</span></span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br><span class="line">/mnt 172.16.10.0/24</span><br></pre></td></tr></table></figure>
<p>exportfs卸载所有的共享目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># exportfs -au</span></span><br></pre></td></tr></table></figure>
<p>查看共享目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># showmount -e localhost</span></span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br></pre></td></tr></table></figure>
<h2 id="NFS-server端设置"><a href="#NFS-server端设置" class="headerlink" title="NFS server端设置"></a>NFS server端设置</h2><h3 id="etc-exports"><a href="#etc-exports" class="headerlink" title="/etc/exports"></a>/etc/exports</h3><p>共享的目录 主机名称1或IP1(参数1，参数2) 主机名称2或IP2(参数3，参数4)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">EXAMPLE</span><br><span class="line">      <span class="comment"># sample /etc/exports file</span></span><br><span class="line">      /               master(rw) trusty(rw,no_root_squash)</span><br><span class="line">      /projects       proj*.local.domain(rw)</span><br><span class="line">      /usr            *.local.domain(ro) @trusted(rw)</span><br><span class="line">      /home/joe       pc001(rw,all_squash,anonuid=150,anongid=100)</span><br><span class="line">      /pub            *(ro,insecure,all_squash)</span><br><span class="line">      /srv/www        -sync,rw server @trusted @external(ro)</span><br><span class="line">      /foo            2001:db8:9:e54::/64(rw) 192.0.2.0/24(rw)</span><br><span class="line">      /build          buildhost[0-9].local.domain(rw)</span><br></pre></td></tr></table></figure>
<h3 id="NFS配置参数"><a href="#NFS配置参数" class="headerlink" title="NFS配置参数"></a>NFS配置参数</h3><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">rw</td>
<td style="text-align:left">Read-Write,表示可读写的权限</td>
</tr>
<tr>
<td style="text-align:left">ro</td>
<td style="text-align:left">Read-only,表示只读的权限</td>
</tr>
<tr>
<td style="text-align:left">no_root_squash</td>
<td style="text-align:left">登入NFS主机使用分享目录的使用者，如果是root的话，那么对于这个分享的目录来说，他就具有root的权限！这个项目『极不安全』，不建议使用！</td>
</tr>
<tr>
<td style="text-align:left">root_squash</td>
<td style="text-align:left">在登入NFS主机使用分享之目录的使用者如果是root时，那么这个使用者的权限将被压缩成为匿名使用者，通常他的UID与GID都会变成nobody或者nfsnobody身份；</td>
</tr>
<tr>
<td style="text-align:left">all_squash</td>
<td style="text-align:left">不论登入NFS的使用者身份为何，他的身份都会被压缩成为匿名使用者，同时他的UID与GID都会变成nobody或nfsnobody账号身份，在多个NFS客户端同时读写NFS server数据时，这个参数很有用；</td>
</tr>
<tr>
<td style="text-align:left">anonuid</td>
<td style="text-align:left">前面关于*_squash提到的匿名使用者的UID设定值，通常为nobody，但是你可以自行设定这个UID的值！当然，这个UID必需要存在于你的/etc/passwd当中！</td>
</tr>
<tr>
<td style="text-align:left">anongid</td>
<td style="text-align:left">同anonuid，但是变成group ID就是了</td>
</tr>
<tr>
<td style="text-align:left">sync</td>
<td style="text-align:left">请求或写入数据时，数据同步写入到NFS Server的硬盘后才返回。##数据不会丢。缺点，性能差</td>
</tr>
<tr>
<td style="text-align:left">async</td>
<td style="text-align:left">请求或写入数据时，先返回请求，再将数据写入到内存缓存和硬盘中，即异步写入数据。此参数可以提升NFS性能，但会降低数据的阿泉。因此，一般情况下不建议使用，如果NFS处于瓶颈状态，并且允许数据丢失的话可以打开此参数提升NFS性能。写入时会先放到内存缓冲区，等硬盘有空档在写入磁盘，这样可以提升写入效率，风险为若服务器宕机或不正常关机，会损失缓冲区中未写入磁盘的数据（服务器主板电视，UPS电源）！</td>
</tr>
<tr>
<td style="text-align:left">Secure</td>
<td style="text-align:left">不允许客户端使用大于1024的客户端port，也就是从服务端传递资料到客户端的目的地要小于1024，此时客户端一定要使用root账号才能mount远端NFS server。通常会建议使用。</td>
</tr>
</tbody>
</table>
<h2 id="客户端IP地址"><a href="#客户端IP地址" class="headerlink" title="客户端IP地址"></a>客户端IP地址</h2><table>
<thead>
<tr>
<th style="text-align:left">客户端地址</th>
<th style="text-align:left">具体地址例子</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">授权单一客户访问NFS</td>
<td style="text-align:left">10.0.0.30</td>
<td style="text-align:left">一般情况，生产环境中此配置不多</td>
</tr>
<tr>
<td style="text-align:left">授权整个网段可访问NFS</td>
<td style="text-align:left">10.0.0.0/24</td>
<td style="text-align:left">其中的24等于255.255.255.0，制定瓦工段为生产环境中最常见的配置。配置简单，维护方便</td>
</tr>
<tr>
<td style="text-align:left">授权整个网段可访问NFS</td>
<td style="text-align:left">10.0.0.*</td>
<td style="text-align:left">指定网段的另外写法（需要验证）</td>
</tr>
<tr>
<td style="text-align:left">授权某个域名客户端访问NFS</td>
<td style="text-align:left">Nfs.oldboy.cc</td>
<td style="text-align:left">此方法生产环境中一般情况不常用</td>
</tr>
<tr>
<td style="text-align:left">授权某个域名客户端访问NFS</td>
<td style="text-align:left">*.oldboy.cc</td>
<td style="text-align:left">此方法生产环境中一般情况不常用</td>
</tr>
</tbody>
</table>
<h3 id="配置NFS生产重要技巧"><a href="#配置NFS生产重要技巧" class="headerlink" title="配置NFS生产重要技巧"></a>配置NFS生产重要技巧</h3><ol>
<li>确保所有服务器对NFS共享目录具备相同的权限。<br>1.1 all_squash把所有客户端都压缩成匿名用户<br>1.2 就是anonuid,anongid制定的UID和GID的用户。</li>
<li>所有的客户端和服务端都需要有一个相同的UID和GID的用户，即nfsnodoby(UID必须相同)，如果客户端没有服务端指定的用户则创建文件时客户端会显示nfsnodoby这个用户，服务端则显示自己设置的用户；</li>
</ol>
<h2 id="实战配置NFS服务"><a href="#实战配置NFS服务" class="headerlink" title="实战配置NFS服务"></a>实战配置NFS服务</h2><h3 id="配置NFS服务端"><a href="#配置NFS服务端" class="headerlink" title="配置NFS服务端"></a>配置NFS服务端</h3><p>安装NFS软件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum –y install nfs-utils rpcbind</span><br></pre></td></tr></table></figure>
<p>配置NFS服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># echo "/mnt 172.16.10.0/24(rw,sync)" &gt;&gt; /etc/exports</span></span><br><span class="line">[root@ansheng ~]<span class="comment"># cat /etc/exports </span></span><br><span class="line">/mnt 172.16.10.0/24(rw,sync)</span><br></pre></td></tr></table></figure>
<p>设置授权</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># chown -R nfsnobody.nfsnobody /mnt/</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看NFS默认使用的用户以及共享的参数：<code>cat /var/lib/nfs/etab</code></p>
</blockquote>
<p>启动服务并设置开机启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/rpcbind start</span></span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/nfs start</span></span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br><span class="line">[root@ansheng ~]<span class="comment"># chkconfig rpcbind on</span></span><br><span class="line">[root@ansheng ~]<span class="comment"># chkconfig nfs on</span></span><br></pre></td></tr></table></figure>
<p>查看rpcbind与nfs服务状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/rpcbind status</span></span><br><span class="line">rpcbind (pid  2226) is running...</span><br><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/nfs status</span></span><br><span class="line">rpc.svcgssd is stopped</span><br><span class="line">rpc.mountd (pid 2269) is running...</span><br><span class="line">nfsd (pid 2285 2284 2283 2282 2281 2280 2279 2278) is running...</span><br><span class="line">rpc.rquotad (pid 2264) is running...</span><br></pre></td></tr></table></figure>
<p>重新加载服务（优雅重启）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># /etc/init.d/nfs reload</span></span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># exportfs -r</span></span><br></pre></td></tr></table></figure>
<p>检查或测试挂载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># showmount -e localhost</span></span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br><span class="line">/mnt 172.16.10.0/24</span><br></pre></td></tr></table></figure>
<p>本地挂载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ansheng ~]<span class="comment"># mount 172.16.10.10:/mnt /nfstest/         </span></span><br><span class="line">[root@ansheng ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem         Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3           19G  2.6G   15G  15% /</span><br><span class="line">tmpfs              932M     0  932M   0% /dev/shm</span><br><span class="line">/dev/sda1          190M   73M  108M  41% /boot</span><br><span class="line">172.16.10.10:/mnt   19G  2.6G   15G  15% /nfstest</span><br><span class="line">[root@ansheng ~]<span class="comment"># ls /nfstest/</span></span><br><span class="line">testnsf.txt</span><br><span class="line">[root@ansheng ~]<span class="comment"># cat /nfstest/testnsf.txt </span></span><br><span class="line">hello word!</span><br></pre></td></tr></table></figure>
<h2 id="NFS客户端挂载"><a href="#NFS客户端挂载" class="headerlink" title="NFS客户端挂载"></a>NFS客户端挂载</h2><p>安装软件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]<span class="comment"># yum -y install rpcbind</span></span><br></pre></td></tr></table></figure>
<p>启动RPCbind设置开机自启动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]# /etc/init.d/rpcbind start</span><br><span class="line">Starting rpcbind:                                          [  OK  ]</span><br><span class="line">[root@nfs-node01 ~]# chkconfig rpcbind on</span><br></pre></td></tr></table></figure>
<p><strong>查看服务端共享的目录</strong></p>
<p>安装showmount命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]<span class="comment"># yum -y install nfs-utils</span></span><br></pre></td></tr></table></figure>
<p>查看共享目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]<span class="comment"># showmount -e 172.16.10.10</span></span><br><span class="line">Export list <span class="keyword">for</span> 172.16.10.10:</span><br><span class="line">/mnt 172.16.10.0/24</span><br></pre></td></tr></table></figure>
<p>挂载到本地</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]<span class="comment"># mkdir /nfs</span></span><br><span class="line">[root@nfs-node01 ~]<span class="comment"># mount -t nfs 172.16.10.10:/mnt /nfs</span></span><br><span class="line">[root@nfs-node01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem         Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3           19G  3.4G   15G  20% /</span><br><span class="line">tmpfs              932M     0  932M   0% /dev/shm</span><br><span class="line">/dev/sda1          190M   73M  108M  41% /boot</span><br><span class="line">172.16.10.10:/mnt   19G  2.6G   15G  15% /nfs</span><br><span class="line">[root@nfs-node01 ~]<span class="comment"># cat /nfs/testnsf.txt </span></span><br><span class="line">hello word!</span><br></pre></td></tr></table></figure>
<p>卸载已经挂载的NFS</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]<span class="comment"># umount /nfs</span></span><br><span class="line">[root@nfs-node01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        19G  3.4G   15G  20% /</span><br><span class="line">tmpfs           932M     0  932M   0% /dev/shm</span><br><span class="line">/dev/sda1       190M   73M  108M  41% /boot</span><br></pre></td></tr></table></figure>
<p><strong>强制卸载：</strong> <code>umount -lf</code></p>
<h2 id="开机自动挂载NFS"><a href="#开机自动挂载NFS" class="headerlink" title="开机自动挂载NFS"></a>开机自动挂载NFS</h2><p>把挂载的命令写入到/etc/rc.local里面，命令写全路径，这样在启动系统的时候会读取这个文件并且执行挂载的命令，如果写入fstab是不能够实现开机自动挂载的，因为在开机的启动网卡之前会先读取/etc/fstab这个文件，当读取到这个文件系统的时候，网卡并没有启动，这样我要挂载网络文件系统是挂不上的。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@nfs-node01 ~]<span class="comment"># echo '/bin/mount -t nfs 172.16.10.10:/mnt/ /nfs' &gt;&gt; /etc/rc.local</span></span><br><span class="line">[root@nfs-node01 ~]<span class="comment"># tail -1 /etc/rc.local </span></span><br><span class="line">/bin/mount -t nfs 172.16.10.10:/mnt/ /nfs</span><br></pre></td></tr></table></figure>
  </div>
</article>
<div style="text-align:center">
  <hr>
  <img src="/images/wechat.jpg" alt="wechat" style="width:450px;">
</div>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是NFS"><span class="toc-number">1.</span> <span class="toc-text">什么是NFS?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RPC"><span class="toc-number">2.</span> <span class="toc-text">RPC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS在企业中的应用场景"><span class="toc-number">3.</span> <span class="toc-text">NFS在企业中的应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS的安装"><span class="toc-number">4.</span> <span class="toc-text">NFS的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nfs-utils"><span class="toc-number">4.1.</span> <span class="toc-text">nfs-utils</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rpcbind"><span class="toc-number">4.2.</span> <span class="toc-text">rpcbind</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询有没有安装软件包"><span class="toc-number">4.3.</span> <span class="toc-text">查询有没有安装软件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装软件包"><span class="toc-number">4.4.</span> <span class="toc-text">安装软件包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS配置文件路径"><span class="toc-number">5.</span> <span class="toc-text">NFS配置文件路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#showmount命令"><span class="toc-number">6.</span> <span class="toc-text">showmount命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exportfs命令"><span class="toc-number">7.</span> <span class="toc-text">exportfs命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS-server端设置"><span class="toc-number">8.</span> <span class="toc-text">NFS server端设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#etc-exports"><span class="toc-number">8.1.</span> <span class="toc-text">/etc/exports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS配置参数"><span class="toc-number">8.2.</span> <span class="toc-text">NFS配置参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#客户端IP地址"><span class="toc-number">9.</span> <span class="toc-text">客户端IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置NFS生产重要技巧"><span class="toc-number">9.1.</span> <span class="toc-text">配置NFS生产重要技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战配置NFS服务"><span class="toc-number">10.</span> <span class="toc-text">实战配置NFS服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置NFS服务端"><span class="toc-number">10.1.</span> <span class="toc-text">配置NFS服务端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NFS客户端挂载"><span class="toc-number">11.</span> <span class="toc-text">NFS客户端挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开机自动挂载NFS"><span class="toc-number">12.</span> <span class="toc-text">开机自动挂载NFS</span></a></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 ansheng
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-89592236-1', 'auto');
        ga('send', 'pageview');
    </script>


<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'blog-ansheng-me';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


