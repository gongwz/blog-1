<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="MySQLdb模块的主要功能就是提供Python操作MySQL数据库的一个API,通过MySQLdb模块我们可以对数据库进行增,删,改,查, 等操作. MySQLdb工作流程如下:  connection connection方法用于创建客户端与数据库的网络连接.  语法:  MySQLdb.Connect(参数) 参数    参数 类型 说明     host 字符串 MySQL服务器地址">
<meta name="keywords" content="安生,Python">
<meta property="og:type" content="article">
<meta property="og:title" content="Python标准库系列之MySQLdb模块">
<meta property="og:url" content="https://blog.ansheng.me/article/python-standard-library-mysqldb/index.html">
<meta property="og:site_name" content="Welcome to ansheng’s blog!">
<meta property="og:description" content="MySQLdb模块的主要功能就是提供Python操作MySQL数据库的一个API,通过MySQLdb模块我们可以对数据库进行增,删,改,查, 等操作. MySQLdb工作流程如下:  connection connection方法用于创建客户端与数据库的网络连接.  语法:  MySQLdb.Connect(参数) 参数    参数 类型 说明     host 字符串 MySQL服务器地址">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://blog.ansheng.me/images/2016/12/1483022284.png">
<meta property="og:image" content="https://blog.ansheng.me/images/2016/12/1483022315.png">
<meta property="og:image" content="https://blog.ansheng.me/images/2016/12/1483022364.png">
<meta property="og:updated_time" content="2018-07-27T03:26:40.087Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python标准库系列之MySQLdb模块">
<meta name="twitter:description" content="MySQLdb模块的主要功能就是提供Python操作MySQL数据库的一个API,通过MySQLdb模块我们可以对数据库进行增,删,改,查, 等操作. MySQLdb工作流程如下:  connection connection方法用于创建客户端与数据库的网络连接.  语法:  MySQLdb.Connect(参数) 参数    参数 类型 说明     host 字符串 MySQL服务器地址">
<meta name="twitter:image" content="https://blog.ansheng.me/images/2016/12/1483022284.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
          
        
    
    <!-- title -->
    <title>Python标准库系列之MySQLdb模块</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg active"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg active"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu" style="visibility: visible;">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/article/python-standard-library-redis/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/article/python-standard-library-paramiko/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#connection"><span class="toc-number">1.</span> <span class="toc-text">connection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cursor"><span class="toc-number">2.</span> <span class="toc-text">cursor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务"><span class="toc-number">3.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例"><span class="toc-number">4.</span> <span class="toc-text">实例</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Python标准库系列之MySQLdb模块
    </h1>



    <div class="meta">
      <span class="postdate">创建日期：</span>

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>MySQLdb模块的主要功能就是提供Python操作MySQL数据库的一个API,通过MySQLdb模块我们可以对数据库进行<strong><code>增</code>,<code>删</code>,<code>改</code>,<code>查</code>,</strong> 等操作.</p>
<p>MySQLdb工作流程如下:</p>
<p><img src="/images/2016/12/1483022284.png" alt="mysqldb-01"></p>
<h2 id="connection"><a href="#connection" class="headerlink" title="connection"></a>connection</h2><p> <code>connection</code>方法用于创建客户端与数据库的网络连接.</p>
<p> 语法:</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MySQLdb.Connect(参数)</span><br></pre></td></tr></table></figure>
<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">host</td>
<td style="text-align:left">字符串</td>
<td style="text-align:left">MySQL服务器地址</td>
</tr>
<tr>
<td style="text-align:center">port</td>
<td style="text-align:left">整型</td>
<td style="text-align:left">MySQL服务器端口号</td>
</tr>
<tr>
<td style="text-align:center">user</td>
<td style="text-align:left">字符串</td>
<td style="text-align:left">MySQL数据库用户名</td>
</tr>
<tr>
<td style="text-align:center">passwd</td>
<td style="text-align:left">字符串</td>
<td style="text-align:left">MySQL数据库密码</td>
</tr>
<tr>
<td style="text-align:center">db</td>
<td style="text-align:left">字符串</td>
<td style="text-align:left">MySQL数据库库名</td>
</tr>
<tr>
<td style="text-align:center">charset</td>
<td style="text-align:left">字符串</td>
<td style="text-align:left">连接所使用的字符集</td>
</tr>
</tbody>
</table>
<p><strong>例如:</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入MySQLdb模块</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="comment"># 创建一个Connect连接</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn = MySQLdb.Connect(host=<span class="string">'127.0.0.1'</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'as'</span>, db=<span class="string">'USER'</span>, port=<span class="number">3306</span>, charset=<span class="string">"utf8"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = conn.cursor()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(cursor)</span><br><span class="line">&lt;MySQLdb.cursors.Cursor object at <span class="number">0x7f4af5e15550</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(conn)</span><br><span class="line">&lt;_mysql.connection open to <span class="string">'127.0.0.1'</span> at <span class="number">15</span>b1518&gt;</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(conn)</span><br><span class="line">&lt;_mysql.connection closed at <span class="number">15</span>b1518&gt;</span><br></pre></td></tr></table></figure>
<p><strong>connection对象支持的方法</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">方法名</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cursor()</td>
<td style="text-align:left">使用该连接创建并返回游标</td>
</tr>
<tr>
<td style="text-align:center">commit()</td>
<td style="text-align:left">提交当前事务</td>
</tr>
<tr>
<td style="text-align:center">rollback()</td>
<td style="text-align:left">回滚当前事务</td>
</tr>
<tr>
<td style="text-align:center">close()</td>
<td style="text-align:left">关闭连接</td>
</tr>
</tbody>
</table>
<h2 id="cursor"><a href="#cursor" class="headerlink" title="cursor"></a>cursor</h2><p><code>cursor</code>用户执行查询和获取结果,执行流程如下:</p>
<p><img src="/images/2016/12/1483022315.png" alt="mysqldb-02"></p>
<p><strong>cursor对象所支持的方法</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数名</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">execute(“SQL”)</td>
<td style="text-align:left">执行的SQL语句</td>
</tr>
<tr>
<td style="text-align:center">fetchone()</td>
<td style="text-align:left">获取结果的下一行</td>
</tr>
<tr>
<td style="text-align:center">fetchmany(size)</td>
<td style="text-align:left">获取结果的下几行</td>
</tr>
<tr>
<td style="text-align:center">fetchall()</td>
<td style="text-align:left">获取结果剩下的所有行</td>
</tr>
<tr>
<td style="text-align:center">rowcount</td>
<td style="text-align:left">最近一次execute返回数据的行数或影响的行数</td>
</tr>
<tr>
<td style="text-align:center">close()</td>
<td style="text-align:left">关闭游标对象</td>
</tr>
</tbody>
</table>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>访问额更新数据库的一个程序执行单元,执行单元指的就是很多操作的集合,里面的每个操作都是用来访问个更新数据库.</p>
<ul>
<li>原子性: 事务中包括的诸多操作要么都做要么都不做</li>
</ul>
<p>比如银行转账,A用户向B用户转账100,A-100和B+100这两个操作,要么都做,要么都不操作</p>
<ol>
<li>一致性: 事务必须使数据库从一致性状态变到另一个一致性状态</li>
<li>隔离性: 一个事务的执行不能被其他事务干扰</li>
<li>持久性: 事务一旦提交,他对数据库的改变是永久性的</li>
</ol>
<p><strong>开发中怎样使用事务?</strong></p>
<ol>
<li>关闭自动commit: 设置conn.autocommit(False),<code>MySQLdb</code>默认已经为<code>False</code></li>
<li>正常结束事务: conn.commit()</li>
<li>异常结束事务: conn.rollback()</li>
</ol>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><ul>
<li>SELECT查询数据</li>
</ul>
<p>先创建一个<code>user</code>表:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">USER</span>;</span><br><span class="line"><span class="keyword">USE</span> <span class="keyword">USER</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line"><span class="string">`userid`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`username`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`userid`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">9</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<p>插入以下内容</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span>(userid, username) <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">'name1'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span>(userid, username) <span class="keyword">VALUES</span>(<span class="number">2</span>, <span class="string">'name2'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span>(userid, username) <span class="keyword">VALUES</span>(<span class="number">3</span>, <span class="string">'name3'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span>(userid, username) <span class="keyword">VALUES</span>(<span class="number">4</span>, <span class="string">'name4'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span>(userid, username) <span class="keyword">VALUES</span>(<span class="number">5</span>, <span class="string">'name5'</span>);</span><br></pre></td></tr></table></figure>
<p>查看数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM user;</span><br><span class="line">+--------+----------+</span><br><span class="line">| userid | username |</span><br><span class="line">+--------+----------+</span><br><span class="line">|      1 | name1    |</span><br><span class="line">|      2 | name2    |</span><br><span class="line">|      3 | name3    |</span><br><span class="line">|      4 | name4    |</span><br><span class="line">|      5 | name5    |</span><br><span class="line">+--------+----------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn = MySQLdb.Connect(host=<span class="string">'127.0.0.1'</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'as'</span>, db=<span class="string">'USER'</span>, port=<span class="number">3306</span>, charset=<span class="string">"utf8"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = conn.cursor()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>SQL = <span class="string">"SELECT * FROM user"</span></span><br><span class="line"><span class="comment"># 返回获取到的多少行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(SQL)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="comment"># 输出获取到的行数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(cursor.rowcount)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="comment"># 返回第一条数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.fetchone()</span><br><span class="line">(<span class="number">1</span>, <span class="string">'name1'</span>)</span><br><span class="line"><span class="comment"># 返回两条数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.fetchmany(<span class="number">2</span>)</span><br><span class="line">((<span class="number">2</span>, <span class="string">'name2'</span>), (<span class="number">3</span>, <span class="string">'name3'</span>))</span><br><span class="line"><span class="comment"># 返回剩下的所有数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.fetchall()</span><br><span class="line">((<span class="number">4</span>, <span class="string">'name4'</span>), (<span class="number">5</span>, <span class="string">'name5'</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>insert/update/delete</li>
</ul>
<p>流程图:</p>
<p><img src="/images/2016/12/1483022364.png" alt="mysqldb-03"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn = MySQLdb.Connect(host=<span class="string">'127.0.0.1'</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'as'</span>, db=<span class="string">'USER'</span>, port=<span class="number">3306</span>, charset=<span class="string">"utf8"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = conn.cursor()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">"INSERT INTO user(userid, username) VALUES(50, 'name50')"</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">"UPDATE user SET username='as' WHERE userid=1"</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">"DELETE FROM user WHERE userid=2"</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.commit()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.close()</span><br></pre></td></tr></table></figure>
<p>查看数据库表内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM user;</span><br><span class="line">+--------+----------+</span><br><span class="line">| userid | username |</span><br><span class="line">+--------+----------+</span><br><span class="line">|      1 | as       |</span><br><span class="line">|      3 | name3    |</span><br><span class="line">|      4 | name4    |</span><br><span class="line">|      5 | name5    |</span><br><span class="line">|     50 | name50   |</span><br><span class="line">+--------+----------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

  </div>
</article>
<div style="text-align:center">
  <hr>
  <img src="/images/wechat.jpg" alt="wechat" style="width:450px;">
</div>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#connection"><span class="toc-number">1.</span> <span class="toc-text">connection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cursor"><span class="toc-number">2.</span> <span class="toc-text">cursor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务"><span class="toc-number">3.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例"><span class="toc-number">4.</span> <span class="toc-text">实例</span></a></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 ansheng
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="//notes.ansheng.me">Notes</a></li>
         
          <li><a href="/article/python-full-stack-way/">PythonFullStackWay</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-89592236-1', 'auto');
        ga('send', 'pageview');
    </script>


<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'blog-ansheng-me';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


